<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script>
    var objects = [{
      'n': 4
    }, {
      'n': 2
    }, {
      'n': 8
    }, {
      'n': 6
    }];;

    function baseIteratee(iteratee) {
      if (iteratee === null) {
        return val => val;
      }
      if (typeof iteratee === "string") {
        return val => val[iteratee];
      }
      if (typeof iteratee === "function") {
        return iteratee;
      }
      if (iteratee instanceof Array) {
        return function (obj) {
          return obj[iteratee[0]] === iteratee[1];
        }
      } else if (typeof iteratee === "object") {
        if (Object.prototype.toString.call(iteratee) === "[object RegExp]")
          return val => iteratee.test(val);
        else
          return isEqual.bind(null, iteratee);
      }
    }

    function isEqual(a, b) {
      if (a === b) return true;

      if (a == null || typeof a != "object" ||
        b == null || typeof b != "object")
        return false;

      var propsInA = 0,
        propsInB = 0;

      for (var prop in b)
        propsInB += 1;

      for (var prop in a) {
        propsInA += 1;
        if (!(prop in b) || !isEqual(a[prop], b[prop]))
          return false;
      }

      return propsInA <= propsInB;
    }

    function differenceBy(ary, ...values) {
      var res = []
      var map = new Map()
      var last = values[values.length - 1]
      if(typeof last === "function" || typeof last === "string") {
        var iteratee = baseIteratee(last);
        for (let i = 0; i < values.length - 1; ++i) {
          for(let j = 0; j < values[i].length; ++j)
            map.set(iteratee(values[i][j]), true)
        }
      }
      else {
        var iteratee = it => it
        for (let i = 0; i < values.length; ++i) {
          for(let j = 0; j < values[i].length; ++j)
          map.set(iteratee(values[i][j]), true)
        }
      }
      for (let j = 0; j < ary.length; ++j) {
        if (!map.has(iteratee(ary[j])))
          res.push(ary[j])
      }
      return res
    }


    function treeToArray(tree) {
      let ary = new Array()

      function translate(tree, pos) {
        if (!tree)
          return
        ary[pos] = root.val
        translate(root.left, pos * 2 + 1)
        translate(root.right, pos * 2 + 2)
      }
      translate(tree, 0)
    }

    /* 
    
    输入：differenceBy([2.1,1.2],[2.3,3.4],Math.floor)
输出/期望：[1.2]
=================
输入：differenceBy([{"x":2},{"x":1}],[{"x":1}],"x")
输出/期望：[{"x":2}]
=================
输入：differenceBy([2,1],[2,3],it => it)
输出/期望：[1]
=================
错误：TypeError: iteratee is not a function
    at Object.differenceBy (eval at runCode (http://02f9az.coding-pages.com/lodash-oj8/:279:5), :325:15)
    at compareTest (http://02f9az.coding-pages.com/lodash-oj8/libs/tester.js:98:19)
    at http://02f9az.coding-pages.com/lodash-oj8/libs/tester.js:20:16
    at Array.map ()
    at test (http://02f9az.coding-pages.com/lodash-oj8/libs/tester.js:18:22)
    at http://02f9az.coding-pages.com/lodash-oj8/:343:20
    at Array.map ()
    at http://02f9az.coding-pages.com/lodash-oj8/:342:40
输入：differenceBy([1,2,3,4],[2,3,4,5])
期望：[1]
=================
输入：differenceBy([1,2,3,4],[1,3],[4])
输出：[]
期望：[2]
=================
输入：differenceBy([1,2,3,4,5,6,7,8],[1,3],[4,8],[6],it => it)
输出：[]
期望：[2,5,7]
*/
  </script>
</head>

<body>

</body>

</html>
